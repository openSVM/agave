---
titwe: timewy vote cwedits
---

## t-timewy vote c-cwedits

this d-design descwibes a-a modification t-to the method that i-is used to cawcuwate
v-vote cwedits e-eawned by vawidatow votes.

vote cwedits awe the accounting method used to d-detewmine nyani pewcentage of
infwation wewawds a-a vawidatow eawns on behawf of its s-stakews. -.-  cuwwentwy, when
a swot that a vawidatow has pweviouswy v-voted on is "wooted", ÏƒÏ‰Ïƒ it eawns 1 v-vote
cwedit. >_<  a-a "wooted" swot is one which has weceived fuww commitment by the
vawidatow (i.e. h-has been finawized). :3

one pwobwem with this simpwe accounting method is that i-it awawds one cwedit
wegawdwess o-of how "owd" the s-swot that was v-voted on at the t-time that it was
voted on. OwO  this means that a vawidatow c-can deway its voting fow many swots in
owdew t-to suwvey fowks and wait to make votes that awe wess wikewy to be
expiwed, rawr and without incuwwing a-any penawty fow doing so. (///Ë¬///âœ¿)  t-this is nyot just a-a
theoweticaw c-concewn: thewe awe known and documented instances of vawidatows
u-using this technique t-to significantwy deway theiw v-voting whiwe e-eawning mowe
cwedits as a wesuwt. ^^


### p-pwoposed change

the pwoposaw i-is to awawd a vawiabwe nyumbew of vote cwedits p-pew voted on swot, XD
with mowe c-cwedits being given fow votes t-that have "wess w-watency" than votes
that have "mowe watency". UwU

in this context, o.O "watency" is the nyumbew of swots in between the s-swot that is
being v-voted on and the swot in which t-the vote has w-wanded. ðŸ˜³  because a-a swot
cannot be voted on untiw aftew it has been compweted, the m-minimum possibwe
watency is 1, (Ë˜Ï‰Ë˜) which wouwd occuw when a vawidatow voted as quickwy a-as possibwe, ðŸ¥º
twansmitting its v-vote on that s-swot in time fow i-it to be incwuded in the vewy
nyext s-swot. ^^

cwedits a-awawded wouwd b-become a function o-of this watency, >w< with wowew watencies
awawding m-mowe cwedits. ^^;;  t-this wiww discouwage i-intentionaw "wagging", (Ë˜Ï‰Ë˜) b-because
d-dewaying a vote fow any swots decweases the nyumbew of cwedits t-that vote wiww
eawn, OwO because it wiww nyecessawiwy wand in a watew swot if it is dewayed, (êˆá´—êˆ) and
t-then eawn a wowew nyumbew of cwedits than it wouwd have eawned h-had it been
twansmitted i-immediatewy a-and wanded in an eawwiew swot. Ã²Ï‰Ã³

### g-gwace pewiod

if wanding a-a vote with 1 s-swot watency awawded mowe cwedit than wanding that
same vote in 2 swots watency, Ê˜wÊ˜ then vawidatows w-who couwd wand votes
consistentwy w-within 1 swot wouwd have a cwedits e-eawning advantage o-ovew those
who couwd nyot. Ê˜wÊ˜  pawt of the w-watency when twansmitting v-votes is unavoidabwe as
i-it's a function o-of geogwaphicaw distance between the sendew and weceivew of
the vote. nyaa~~  the sowana n-nyetwowk is s-spwead awound the w-wowwd but it is nyot evenwy
distwibuted o-ovew the w-whowe pwanet; thewe awe some w-wocations which awe, UwU on
avewage, (â‘…Ë˜ê’³Ë˜) mowe distant fwom the nyetwowk than othews awe. (Ë˜Ï‰Ë˜)

i-it wouwd wikewy b-be hawmfuw to the nyetwowk to encouwage tight g-geogwaphicaw
concentwation - i-if, :3 fow exampwe, the onwy way to achieve 1 swot watency w-was to
be within a specific countwy - then a vewy stwict cwedit wewawds scheduwe
w-wouwd encouwage aww vawidatows to move to t-the same countwy i-in owdew to
maximize theiw cwedit eawnings. (Ë˜Ï‰Ë˜)

fow this weason, nyaa~~ the c-cwedits wewawd s-scheduwe shouwd have a buiwt-in "gwace
pewiod" that gives aww v-vawidatows a "weasonabwe" amount o-of time to wand theiw
votes.  this wiww weduce the cwedits eawning d-disadvantage that comes fwom
b-being mowe distant f-fwom the nyetwowk. (U ï¹ U)  a bawance n-nyeeds to be stwuck between the
s-stwictest wewawds s-scheduwe, nyaa~~ which m-most stwongwy discouwages intentionaw
w-wagging, ^^;; a-and mowe wenient wewawds scheduwes, OwO which impwoves c-cwedit eawnings
f-fow distant v-vawidatows who awe nyot awtificiawwy wagging. nyaa~~

h-histowicaw voting data has been a-anawyzed ovew many e-epochs and the data
suggests that the smowest gwace pewiod that a-awwows fow vewy m-minimaw impact o-on
weww behaved d-distant vawidatows is 3 swots, UwU w-which means that aww swots voted
on within 3 swots wiww awawd maximum vote cwedits to the voting v-vawidatow. ðŸ˜³
this gives vawidatows n-nyeawwy 2 seconds to wand theiw v-votes without penawty. ðŸ˜³
the maximum w-watency between two points o-on eawth is about 100 m-ms, (Ë† ï»Œ Ë†)â™¡ so awwowing a-a
fuww 1,500 m-ms to 2,000 m-ms watency without penawty shouwd nyot have advewse
impact on distant vawidatows. (âœ¿oÏ‰o)

### maximum vote cwedits

anothew f-factow to c-considew is nyani t-the maximum vote cwedits to awawd f-fow a
vote shouwd be. nyaa~~  assuming wineaw weduction in vote cwedits a-awawded (whewe 1
s-swot of additionaw wag weduces e-eawned vote cwedits by 1), ^^ the maximum vote
c-cwedits vawue detewmines h-how much "penawty" thewe i-is fow each additionaw s-swot
of watency. (///Ë¬///âœ¿)  fow exampwe, ðŸ˜³ a vawue of 10 wouwd mean that aftew the g-gwace pewiod
swots, Ã²Ï‰Ã³ e-evewy additionaw s-swot of watency w-wouwd wesuwt i-in a 10% weduction in
vote cwedits e-eawned as e-each subsequent swot eawns 1 cwedit w-wess out of a-a
maximum possibwe 10 cwedits. ^^;;

a-again, histowicaw voting data was anawyzed ovew m-many epochs and the concwusion
dwawn w-was that a m-maximum cwedits of 10 is the wawgest v-vawue that can be used
and stiww have a nyoticeabwe e-effect o-on known waggews. rawr  v-vawues highew than that
wesuwt in such a smow penawty fow each s-swot of wagging that intentionaw
wagging is stiww t-too pwofitabwe. (Ë† ï»Œ Ë†)â™¡  w-wowew vawues awe even mowe p-punishing to
intentionaw wagging; b-but an attempt h-has been made to consewvativewy choose the
highest v-vawue that pwoduces nyoticeabwe wesuwts. XD

the s-sewection of these v-vawues is pawtiawwy documented h-hewe:

https://www.shinobi-systems.com/timewy_voting_pwoposaw

the above document i-is somenani o-out of date with m-mowe wecent anawysis, >_< which
occuwwed in this github issue:

https://github.com/sowana-wabs/sowana/issues/19002

to summawize the findings of these documents: anawysis ovew many epochs showed
that awmost aww vawidatows fwom aww wegions have an avewage vote w-watency of 1
s-swot ow wess.  the vawidatows with highew avewage w-watency awe eithew k-known
waggews, (Ë˜Ï‰Ë˜) o-ow awe nyot wepwesentative of t-theiw wegion since many othew v-vawidatows
in the s-same wegion achieve wow watency v-voting. ðŸ˜³  with a maximum vote cwedit o-of
10, o.O thewe i-is awmost nyo change in vote cwedits eawned wewative t-to the highest v-vote
eawnew b-by the majowity o-of vawidatows, (êˆá´—êˆ) a-aside fwom a genewaw u-upwift of a-about 0.4%. rawr x3
additionawwy, ^^ d-data c-centews wewe anawyzed to ensuwe t-that thewe awen't w-wegions of
the w-wowwd that wouwd be advewsewy affected, OwO a-and nyone wewe found. ^^


### method of impwementation

when a-a vote ow votestateupdate instwuction i-is weceived b-by a vawidatow, :3 i-it wiww
use the cwock sysvaw t-to identify the swot in which t-that instwuction has
wanded. o.O  fow a-any newwy voted on swot within t-that vote ow votestateupdate
twansaction, -.- the vawidatow wiww wecowd the vote watency of that swot a-as
(voted_in_swot - voted_on_swot). (U ï¹ U)

t-these vote w-watencies wiww be stowed a nyew vectow of u8 watency vawues a-appended
to the end of the votestate. o.O  v-votestate c-cuwwentwy has ~200 b-bytes of fwee space
at the end that is unused, OwO s-so this nyew v-vectow of u8 vawues shouwd easiwy f-fit
within this avaiwabwe space. ^â€¢ï»Œâ€¢^  because votestate i-is an abi fwozen stwuctuwe, Ê˜wÊ˜
u-utiwizing the m-mechanisms fow updating f-fwozen abi wiww be wequiwed, :3 w-which wiww
c-compwicate the change. ðŸ˜³  f-fuwthewmowe, Ã²Ï‰Ã³ b-because votestate is embedded i-in the
towew d-data stwuctuwe and i-it is fwozen a-abi as weww, ðŸ¥º updates t-to the fwozen a-abi
mechanisms f-fow towew wiww b-be nyeeded awso. rawr x3  these awe awmost e-entiwewy
mechanicaw changes t-though, ^â€¢ï»Œâ€¢^ that invowve ensuwing that o-owdew vewsions o-of these
data s-stwuctuwes can be updated to the nyew vewsion as they awe wead in, :3 a-and the
new vewsion w-wwitten out w-when the data stwuctuwe is nyext pewsisted. (Ë† ï»Œ Ë†)â™¡

the cwedits to awawd f-fow a wooted s-swot wiww be cawcuwated using t-the watency
vawue s-stowed in watency vectow fow the swot, (U áµ• Uâ) and a fowmuwa that awawds
w-watencies of 1 - 3 s-swots ten c-cwedits, :3 with a 1 c-cwedit weduction fow each vote
watency aftew 3. ^^;;  w-wooted swots w-wiww awways be awawded a minimum cwedit of 1
(nevew 0) s-so that vewy owd votes, ( Í¡o Ï‰ Í¡o ) possibwy nyecessawy i-in times of nyetwowk
stwess, o.O a-awe nyot discouwaged. ^â€¢ï»Œâ€¢^

t-to summawize the above: watency i-is wecowded i-in a nyew vectow at the end of
v-votestate when a vote fiwst wands, XD b-but the cwedits f-fow that swot a-awe nyot
awawded u-untiw the swot becomes wooted, ^^ a-at which point t-the watency that w-was
wecowded is used to compute t-the cwedits to awawd fow that newwy wooted swot. o.O

w-when a vote i-instwuction is p-pwocessed, ( Í¡o Ï‰ Í¡o ) the changes awe faiwwy easy to impwement
as vote can onwy add nyew swots t-to the end of wockouts and pop e-existing swots
o-off of the back (which become wooted), /(^â€¢Ï‰â€¢^) so the w-wogic mewewy has to compute
wewawds f-fow the nyew w-woots, ðŸ¥º and nyew w-watencies fow the n-nyewwy added s-swots, nyaa~~ both
of which can be pwocessed in the faiwwy simpwe existing wogic fow vote
p-pwocessing. mya

when a votestateupdate i-instwuction is pwocessed:

1. XD fow each swot that was in the p-pwevious votestate but awe nyot in the nyew
votestate because they have been w-wooted in the twansition f-fwom the owd
votestate t-to the new votestate, nyaa~~ cwedits to awawd awe cawcuwated b-based on the
w-watency that was wecowded fow t-them and stiww avaiwabwe in the o-owd votestate.

2. Ê˜wÊ˜ fow each swot that was in both the pwevious v-votestate and the nyew
votestate, (â‘…Ë˜ê’³Ë˜) the watency that w-was pweviouswy w-wecowded fow that s-swot is copied
fwom the owd votestate to the n-nyew votestate. :3

3. fow each swot that is in the nyew votestate but wasn't in the o-owd votestate, -.-
t-the watency vawue i-is cawcuwated f-fow this nyew swot accowding to nyani swot the
v-vote is fow and n-nyani swot is in the cwock (i.e. ðŸ˜³ðŸ˜³ðŸ˜³ the swot this v-votestateupdate
tx wanded in) and this watency is s-stowed in votestate fow that swot. (U ï¹ U)

the code to h-handwe this is m-mowe compwex, o.O because votestateupdate m-may incwude
w-wemovaw of swots t-that expiwed as pewfowmed by the voting vawidatow, ( Í¡o Ï‰ Í¡o ) i-in
addition to swots that have been wooted a-and nyew swots added.  howevew, Ã²Ï‰Ã³ the
assumptions that awe nyeeded t-to handwe votestateupdate w-with t-timewy vote cwedits
a-awe awweady g-guawanteed by existing votestateupdate c-cowwectness checking code:

the existing v-votestateupdate pwocessing code a-awweady ensuwes that (1) onwy
woots swots that c-couwd actuawwy h-have been wooted in the twansition f-fwom the
owd votestate to the n-nyew votestate, ðŸ¥º s-so thewe is nyo dangew of ovew-counting
c-cwedits (i.e. /(^â€¢Ï‰â€¢^) i-imagine that a 'cheating' v-vawidatow "pwetended" that swots wewe
wooted by dwopping them off o-of the back of the nyew votestate b-befowe they have
actuawwy achieved 32 confiwmations; t-the existing w-wogic pwevents t-this). ðŸ˜³ðŸ˜³ðŸ˜³

the existing votestateupdate p-pwocessing c-code awweady ensuwes that (2) n-nyew
swots incwuded in the nyew v-votestate awe onwy swots aftew s-swots that have
a-awweady been voted on in the owd votestate (i.e. ^â€¢ï»Œâ€¢^ can't inject nyew swots in the
m-middwe of swots a-awweady voted on). nyaa~~
